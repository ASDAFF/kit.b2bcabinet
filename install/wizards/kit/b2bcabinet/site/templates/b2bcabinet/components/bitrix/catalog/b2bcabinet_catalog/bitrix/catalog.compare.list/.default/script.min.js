!function(t){t.JCCatalogCompareList||(t.JCCatalogCompareList=function(t){this.obCompare=null,this.obAdminPanel=null,this.visual=t.VISUAL,this.ajax=t.AJAX,this.position=t.POSITION,BX.ready(BX.proxy(this.init,this))},t.JCCatalogCompareList.prototype.init=function(){this.obCompare=BX(this.visual.ID),BX.type.isElementNode(this.obCompare)&&(BX.addCustomEvent(t,"OnCompareChange",BX.proxy(this.reload,this)),BX.bindDelegate(this.obCompare,"click",{tagName:"a"},BX.proxy(this.deleteCompare,this)),this.position.fixed&&"top"===this.position.align.vertical&&(this.obAdminPanel=BX("bx-panel"),BX.type.isElementNode(this.obAdminPanel)&&(this.setVerticalAlign(),BX.addCustomEvent(t,"onTopPanelCollapse",BX.proxy(this.setVerticalAlign,this)))))},t.JCCatalogCompareList.prototype.reload=function(){BX.showWait(this.obCompare),BX.ajax.post(this.ajax.url,this.ajax.reload,BX.proxy(this.reloadResult,this))},t.JCCatalogCompareList.prototype.reloadResult=function(t){var e="none";BX.closeWait(),this.obCompare.innerHTML=t,BX.type.isNotEmptyString(t)&&t.indexOf("<table")>=0&&(e="block"),BX.style(this.obCompare,"display",e)},t.JCCatalogCompareList.prototype.deleteCompare=function(){var t,e,o=BX.proxy_context;o&&o.hasAttribute("data-id")&&(t=parseInt(o.getAttribute("data-id"),10),isNaN(t)||(BX.showWait(this.obCompare),e=this.ajax.url+this.ajax.templates.delete+t.toString(),BX.ajax.loadJSON(e,this.ajax.params,BX.proxy(this.deleteCompareResult,this))))},t.JCCatalogCompareList.prototype.deleteCompareResult=function(t){var e,o,i,a;if(BX.closeWait(),BX.type.isPlainObject(t)&&BX.type.isNotEmptyString(t.STATUS)&&"OK"===t.STATUS&&t.ID){if(BX.onCustomEvent("onCatalogDeleteCompare",[t.ID]),e=this.obCompare.querySelector('table[data-block="item-list"]'),BX.type.isElementNode(e))if(e.rows.length>1){for(o=0;o<e.rows.length;o++)e.rows[o].hasAttribute("data-row-id")&&e.rows[o].getAttribute("data-row-id")==="row"+t.ID&&e.deleteRow(o);(BX.type.isNotEmptyString(t.COUNT)||BX.type.isNumber(t.COUNT))&&(a=parseInt(t.COUNT,10),isNaN(a)||(i=this.obCompare.querySelector('span[data-block="count"]'),BX.type.isElementNode(i)&&(i.innerHTML=a.toString()),i=null,BX.style(this.obCompare,"display",a>0?"block":"none")))}else this.reload();e=null}},t.JCCatalogCompareList.prototype.setVerticalAlign=function(){var t;BX.type.isElementNode(this.obCompare)&&BX.type.isElementNode(this.obAdminPanel)&&(t=parseInt(this.obAdminPanel.offsetHeight,10),isNaN(t)&&(t=0),t+=5,BX.style(this.obCompare,"top",t.toString()+"px"))})}(window);