var allGagdgetHoldersSC=[];function getGadgetHolderSC(t){return allGagdgetHoldersSC[t]}function SCGadget(gadgetHolderID,allGadgets){var _this=this;if(BX.addCustomEvent("onAjaxFailure",function(t){"auth"==t&&(top.location=top.location.href)}),_this.gadgetHolderID=gadgetHolderID,_this.allGadgets=allGadgets,allGagdgetHoldersSC[_this.gadgetHolderID]=_this,_this.menuItems=[],void 0!==arGDGroups)for(var gr_id in arGDGroups){if(arGDGroups.hasOwnProperty(gr_id)){var items=[];for(var _gid in arGDGroups[gr_id].GADGETS)if(arGDGroups[gr_id].GADGETS.hasOwnProperty(_gid)){var gid=arGDGroups[gr_id].GADGETS[_gid];for(var i in _this.allGadgets)if(_this.allGadgets[i].ID.toUpperCase()==gid.toUpperCase()){_this.allGadgets[i].ONCLICK="getGadgetHolderSC('"+_this.gadgetHolderID+"').Add('"+_this.allGadgets[i].ID+"')",items[items.length]=_this.allGadgets[i];break}}}_this.menuItems[gr_id]={ID:gr_id,TEXT:'<div class="widget_button"><div class="widgets_cabinet_title">'+arGDGroups[gr_id].NAME+'</div><div class="widgets_cabinet_descr">'+arGDGroups[gr_id].DESCRIPTION+"</div></div>",MENU:items}}_this.gdList=Array(),_this.gdCols=Array(),_this.__GDList=function(){_this.gdList=Array(),_this.gdCols=Array();var t,e,i,s,d=document.getElementById("GDHolder_"+_this.gadgetHolderID).children;for(s=0;s<d.length;s++)if("s"==d[s].id.substring(0,1)){for(i in e=Array(),t=d[s].childNodes)if(t.hasOwnProperty(i)){if(!t[i])continue;!t[i].tagName||"TABLE"!=t[i].tagName.toUpperCase()&&"DIV"!=t[i].tagName.toUpperCase()||"t"!=t[i].id.substring(0,1)||(e[e.length]=t[i])}_this.gdList[_this.gdCols.length]=e,d[s].realPos=jsUtils.GetRealPos(d[s]),_this.gdCols[_this.gdCols.length]=d[s]}},_this.gdDrag=!1,_this.mousePos={x:0,y:0},_this.zind=0,_this.tmpDiv=!1,_this.DragStart=function(t,e){if(e){if(e.srcElement&&"a"==e.srcElement.tagName.toLowerCase())return!1;if(e.originalTarget&&"a"==e.originalTarget.tagName.toLowerCase())return!1}_this.__GDList();var i=BX("t"+t),s=jsUtils.GetRealPos(i),d=BX("d"+t);return d.style.display="block",d.width=i.offsetWidth+"px",d.style.height=i.offsetHeight+"px",i.style.position="absolute",i.style.width=d.offsetWidth+"px",i.style.height=d.offsetHeight+"px",i.style.border="1px solid #777777",_this.zind=i.style.zIndex,i.style.zIndex="10000",i.style.left=s.left+20+"px",i.style.top=s.top+"px",i.style.MozOpacity=.6,i.style.opacity=.6,i.style.filter="gray() alpha(opacity=60)",_this.gdDrag=t,_this.tmpDiv=document.createElement("DIV"),_this.tmpDiv.style.display="none",_this.tmpDiv.innerHTML="",i.parentNode.insertBefore(_this.tmpDiv,i),document.body.appendChild(i),_this.mousePos.x=e.clientX+document.body.scrollLeft,_this.mousePos.y=e.clientY+document.body.scrollTop,"function"==typeof changeWidgetWidth&&changeWidgetWidth(),!1},_this.onMouseMove=function(t){if(!1!==_this.gdDrag){var e=document.getElementById("t"+_this.gdDrag),i=t.clientX+document.body.scrollLeft,s=t.clientY+document.body.scrollTop;e.style.left=parseInt(e.style.left)+i-_this.mousePos.x+"px",e.style.top=parseInt(e.style.top)+s-_this.mousePos.y+"px";var d,a,n,o=jsUtils.GetRealPos(e),r=!1,l=o.left+(o.right-o.left)/2,g=o.top+(o.bottom-o.top)/2;for(a=0;a<_this.gdCols.length;a++)if((d=_this.gdCols[a].realPos).left<=l&&d.right>=l){for(n in _this.gdList[a])if(_this.gdList[a].hasOwnProperty(n)&&g<(_this.gdList[a][n].id==e.id?jsUtils.GetRealPos(document.getElementById("d"+_this.gdDrag)):jsUtils.GetRealPos(_this.gdList[a][n])).bottom){r=_this.gdList[a][n],_this.tmpDiv=document.createElement("DIV"),_this.tmpDiv.style.display="none",_this.tmpDiv.innerHTML="",_this.gdList[a][n].id==e.id?document.getElementById("d"+_this.gdDrag).parentNode.insertBefore(_this.tmpDiv,document.getElementById("d"+_this.gdDrag)):r.parentNode.insertBefore(_this.tmpDiv,r);break}r||(r="last");break}if(r){var h=document.getElementById("d"+_this.gdDrag);h.parentNode.removeChild(h),"last"==r?_this.gdCols[a].appendChild(h):_this.tmpDiv.parentNode.insertBefore(h,_this.tmpDiv)}_this.mousePos.x=i,_this.mousePos.y=s,"function"==typeof changeWidgetWidth&&changeWidgetWidth()}},_this.onMouseUp=function(t){if(!1!==_this.gdDrag){var e=BX("t"+_this.gdDrag);e.style.MozOpacity=1,e.style.opacity=1,e.style.filter="",e.style.position="static",e.style.border="0px",e.style.width="",e.style.height="",e.style.zIndex=_this.zind;var i=BX("d"+_this.gdDrag);i.style.display="none",e.parentNode.removeChild(e),i.parentNode.insertBefore(e,i),_this.gdDrag=!1,_this.sendWait||(_this.sendWait=!0,setTimeout("getGadgetHolderSC('"+_this.gadgetHolderID+"').SendUpdatedInfo();",1e3)),"function"==typeof changeWidgetWidth&&changeWidgetWidth()}},_this.GetPosString=function(){var t,e,i,s=document.getElementById("GDHolder_"+_this.gadgetHolderID).children,d="",a=-1,n=0;for(i=0;i<s.length;i++)if("s"==s[i].id.substring(0,1))for(e in a++,n=0,t=s[i].childNodes)if(t.hasOwnProperty(e)){if(!t[e])continue;!t[e].tagName||"TABLE"!=t[e].tagName.toUpperCase()&&"DIV"!=t[e].tagName.toUpperCase()||"t"!=t[e].id.substring(0,1)||(d=d+"&POS["+a+"]["+n+"]="+encodeURIComponent(t[e].id.substring(1))+(t[e].className.indexOf(" gdhided")>0?"*H":""),n++)}return d},_this.GetPos=function(){var t,e,i,s=document.getElementById("GDHolder_"+_this.gadgetHolderID).children,d=[],a=-1,n=0;for(i=0;i<s.length;i++)if("s"==s[i].id.substring(0,1))for(e in a++,n=0,t=s[i].childNodes)if(t.hasOwnProperty(e)){if(!t[e])continue;!t[e].tagName||"TABLE"!=t[e].tagName.toUpperCase()&&"DIV"!=t[e].tagName.toUpperCase()||"t"!=t[e].id.substring(0,1)||(void 0===d[a]&&(d[a]=[]),d[a][n]=t[e].id.substring(1)+(t[e].className.indexOf(" gdhided")>0?"*H":""),n++)}return d},_this.SendUpdatedInfo=function(t){t=t||"update_position",_this.sendUpdate||!1!==_this.gdDrag?setTimeout("getGadgetHolderSC('"+_this.gadgetHolderID+"').SendUpdatedInfo('"+t+"');",500):(_this.sendUpdate=!0,_this.sendWait=!1,BX.ajax({url:updateURL,method:"POST",dataType:"html",data:{sessid:BX.bitrix_sessid(),gd_ajax:_this.gadgetHolderID,gd_ajax_action:t,POS:_this.GetPos()},onsuccess:function(e){_this.sendUpdate=!1,"clear_settings"==t&&(window.location=window.location)},onfailure:function(t){_this.sendUpdate=!1,alert(langGDError1)}}))},_this.Add=function(t){var e=document.getElementById("GDHolderForm_"+_this.gadgetHolderID);e.gid.value=t,e.action.value="add",e.submit()},_this.UpdSettings=function(t){var e=document.getElementById("GDHolderForm_"+_this.gadgetHolderID);function i(t,i){var s;if("object"==typeof i||i instanceof Array)for(var d in i)i.hasOwnProperty(d)&&((s=document.createElement("INPUT")).type="hidden",s.name="settings["+t+"][]",s.value=i[d],e.appendChild(s));else(s=document.createElement("INPUT")).type="hidden",s.name="settings["+t+"]",s.value=i,e.appendChild(s)}e.gid.value=t,e.action.value="update";for(var s,d=document.getElementById("dset"+t),a=0;a<d._inputs.length;a++)if(s=document.getElementById(t+"_"+d._inputs[a]))if("SELECT"==s.tagName.toUpperCase()&&s.multiple){for(var n=[],o=0;o<s.options.length;o++)s.options[o].selected&&n.push(s.options[o].value);i(d._inputs[a],n)}else"INPUT"==s.tagName.toUpperCase()&&"CHECKBOX"==s.type.toUpperCase()?i(d._inputs[a],s.checked?"Y":"N"):i(d._inputs[a],s.value);e.submit()},_this.SetForAll=function(){langGDConfirm=langGDConfirm1,arguments[0]&&("SU"==arguments[0]&&(langGDConfirm=langGDConfirmUser),"SG"==arguments[0]&&(langGDConfirm=langGDConfirmGroup)),confirm(langGDConfirm)&&_this.SendUpdatedInfo("save_default")},_this.ClearUserSettings=function(){_this.SendUpdatedInfo("clear_settings")},_this.ClearUserSettingsConfirm=function(){confirm(langGDClearConfirm)&&_this.SendUpdatedInfo("clear_settings")},_this.Delete=function(t){var e=document.getElementById("t"+t);e&&e.parentNode.removeChild(e);var i=document.getElementById("d"+t);return i&&i.parentNode.removeChild(i),_this.sendWait||(_this.sendWait=!0,setTimeout("getGadgetHolderSC('"+_this.gadgetHolderID+"').SendUpdatedInfo();",500)),"function"==typeof changeWidgetWidth&&changeWidgetWidth(),!1},_this.Hide=function(t,e){var i=document.getElementById("t"+t);if(i){for(var s=i.className.split(" "),d="",a=0;a<s.length;a++)-1!=s[a].search("sotbit")&&(d+=s[a]+" ");return i.className.indexOf(" gdhided")>0?i.className="data-table-gadget "+d:i.className="data-table-gadget gdhided "+d,_this.sendWait||(_this.sendWait=!0,setTimeout("getGadgetHolderSC('"+_this.gadgetHolderID+"').SendUpdatedInfo();",500)),"function"==typeof changeWidgetWidth&&changeWidgetWidth(),!1}},_this.CloseSettingsForm=function(t){document.getElementById("dset"+t).style.display="none"},SCGadget.prototype.ShowSettings=function(id,t){var dS=document.getElementById("dset"+id),is_selected="";return t=t||"get_settings",_this=this,"none"!=dS.style.display?(dS.style.display="none",void("function"==typeof changeWidgetWidth&&changeWidgetWidth())):(BX.ajax({url:updateURL,method:"POST",dataType:"html",data:{sessid:BX.bitrix_sessid(),gd_ajax:_this.gadgetHolderID,gid:id,gd_ajax_action:t},onsuccess:function(data){var before=(new Date).getTime(),dSet=document.getElementById("dset"+id),param,param_id,oEl;dSet.innerHTML="",dSet._inputs=[];try{eval("var gdObject = "+data)}catch(t){return}for(param_id in gdObject)if(gdObject.hasOwnProperty(param_id)){param=gdObject[param_id];var str="",input_id=id+"_"+param_id;if(param.TYPE=param.TYPE||"STRING",param.VALUE||"undefined"==param.DEFAULT||(param.VALUE=param.DEFAULT),"STRING"==param.TYPE)str="<span>"+param.NAME+':</span><input type="text" id="'+input_id+'" size="40" value="'+jsUtils.htmlspecialchars(param.VALUE)+'">';else if("LIST"==param.TYPE){var aR=[];for(var vid in param.VALUES)if(param.VALUES.hasOwnProperty(vid)){if("Y"==param.MULTIPLE)if(is_selected="",param.VALUE instanceof Array){for(var k=0;k<param.VALUE.length;k++)if(param.VALUE[k]==vid){is_selected=" selected";break}}else is_selected=param.VALUE==vid?" selected":"";else is_selected=param.VALUE==vid?" selected":"";aR.push('<option value="'+vid+'" '+is_selected+">"+param.VALUES[vid]+"</option>")}str="<span>"+param.NAME+':</span><select class="'+param.NAME+'-select" id="'+input_id+'" '+("Y"==param.MULTIPLE?'multiple="multiple"':"")+">"+aR.join("")+"</select>"}else"CHECKBOX"==param.TYPE&&(str=param.NAME+': <input type="checkbox" id="'+input_id+'" value="Y" '+("Y"==param.VALUE?" checked":"")+">");oEl=document.createElement("DIV"),oEl.setAttribute("class","gdsettrow "+param_id),oEl.innerHTML=str,dSet.appendChild(oEl),dSet._inputs[dSet._inputs.length]=param_id}oEl=document.createElement("DIV"),oEl.setAttribute("class","gdsettrow button-row"),oEl.innerHTML='<input type="button" class="button-ok" value="OK" onclick="getGadgetHolderSC(\''+_this.gadgetHolderID+"').UpdSettings('"+id+'\');"> <input type="button" class="button-cancel" value="'+langGDCancel+'" onclick="getGadgetHolderSC(\''+_this.gadgetHolderID+"').CloseSettingsForm('"+id+"');\">",dSet.appendChild(oEl),dSet.style.display="block","function"==typeof changeWidgetWidth&&changeWidgetWidth()},onfailure:function(t){alert(langGDError2)}}),!1)},SCGadget.prototype.ShowAddGDMenu=function(t){showAdd()},jsUtils.addEvent(document.body,"mousemove",_this.onMouseMove),jsUtils.addEvent(document.body,"mouseup",_this.onMouseUp)}function showAdd(){for(var t=document.querySelectorAll(".widgets_cabinet"),e=document.querySelector(".body_widgets_main"),i=0;i<t.length;i++)t[i].classList.toggle("show_widgets");e.classList.toggle("body_widgets"),document.querySelector(".body_class").classList.toggle("stop-scrolling")}