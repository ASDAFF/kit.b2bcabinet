BX.namespace("BX.Sale.component.location.selector"),void 0===BX.Sale.component.location.selector.search&&void 0!==BX.ui&&void 0!==BX.ui.widget&&(BX.Sale.component.location.selector.search=function(e,t){this.parentConstruct(BX.Sale.component.location.selector.search,e),BX.merge(this,{opts:{usePagingOnScroll:!0,pageSize:10,arrowScrollAdditional:2,pageUpWardOffset:3,provideLinkBy:"id",bindEvents:{"after-input-value-modify":function(){this.ctrls.fullRoute.value=""},"after-select-item":function(e){this.opts;var t=this.vars.cache.nodes[e],s=t.DISPLAY;if("object"==typeof t.PATH)for(var o=0;o<t.PATH.length;o++)s+=", "+this.vars.cache.path[t.PATH[o]];this.ctrls.inputs.fake.setAttribute("title",s),this.ctrls.fullRoute.value=s,"string"==typeof this.opts.callback&&this.opts.callback.length>0&&this.opts.callback in window&&window[this.opts.callback].apply(this,[e,this])},"after-deselect-item":function(){this.ctrls.fullRoute.value="",this.ctrls.inputs.fake.setAttribute("title","")},"before-render-variant":function(e){if(e.PATH.length>0){for(var t="",s=0;s<e.PATH.length;s++)t+=", "+this.vars.cache.path[e.PATH[s]];e.PATH=t}else e.PATH="";var o="";if(this.vars&&this.vars.lastQuery&&this.vars.lastQuery.QUERY&&(o=this.vars.lastQuery.QUERY),BX.type.isNotEmptyString(o)){var i=[];i=this.opts.wrapSeparate?o.split(/\s+/):[o],e["=display_wrapped"]=BX.util.wrapSubstring(e.DISPLAY+e.PATH,i,this.opts.wrapTagName,!0)}else e["=display_wrapped"]=BX.util.htmlspecialchars(e.DISPLAY)}}},vars:{cache:{path:{},nodesByCode:{}}},sys:{code:"sls"}}),this.handleInitStack(t,BX.Sale.component.location.selector.search,e)},BX.extend(BX.Sale.component.location.selector.search,BX.ui.autoComplete),BX.merge(BX.Sale.component.location.selector.search.prototype,{init:function(){"object"==typeof this.opts.pathNames&&BX.merge(this.vars.cache.path,this.opts.pathNames),this.pushFuncStack("buildUpDOM",BX.Sale.component.location.selector.search),this.pushFuncStack("bindEvents",BX.Sale.component.location.selector.search)},buildUpDOM:function(){var e=this.ctrls,t=(this.opts,this.vars,this.sys.code);e.fullRoute=BX.create("input",{props:{className:"bx-ui-"+t+"-route form-control"},attrs:{type:"text",disabled:"disabled",autocomplete:"off"}}),BX.addClass(e.inputs.fake,"form-control"),BX.style(e.fullRoute,"paddingTop",BX.style(e.inputs.fake,"paddingTop")),BX.style(e.fullRoute,"paddingLeft",BX.style(e.inputs.fake,"paddingLeft")),BX.style(e.fullRoute,"paddingRight","0px"),BX.style(e.fullRoute,"paddingBottom","0px"),BX.style(e.fullRoute,"marginTop",BX.style(e.inputs.fake,"marginTop")),BX.style(e.fullRoute,"marginLeft",BX.style(e.inputs.fake,"marginLeft")),BX.style(e.fullRoute,"marginRight","0px"),BX.style(e.fullRoute,"marginBottom","0px"),"none"!=BX.style(e.inputs.fake,"borderTopStyle")&&(BX.style(e.fullRoute,"borderTopStyle","solid"),BX.style(e.fullRoute,"borderTopColor","transparent"),BX.style(e.fullRoute,"borderTopWidth",BX.style(e.inputs.fake,"borderTopWidth"))),"none"!=BX.style(e.inputs.fake,"borderLeftStyle")&&(BX.style(e.fullRoute,"borderLeftStyle","solid"),BX.style(e.fullRoute,"borderLeftColor","transparent"),BX.style(e.fullRoute,"borderLeftWidth",BX.style(e.inputs.fake,"borderLeftWidth"))),BX.prepend(e.fullRoute,e.container),e.inputBlock=this.getControl("input-block"),e.loader=this.getControl("loader")},bindEvents:function(){var e=this;BX.bindDelegate(this.getControl("quick-locations",!0),"click",{tag:"a"},function(){e.setValueByLocationId(BX.data(this,"id"))}),this.vars.outSideClickScope=this.ctrls.inputBlock},setValueByLocationId:function(e,t){BX.Sale.component.location.selector.search.superclass.setValue.apply(this,[e,t])},setValueByLocationIds:function(e){e.IDS&&this.displayPage({VALUE:e.IDS,order:{TYPE_ID:"ASC","NAME.NAME":"ASC"}})},setValueByLocationCode:function(e,t){var s=this.vars,o=this.opts,i=this.ctrls,a=this;if(this.hideError(),null==e||0==e||void 0===e||0==e.toString().length)return this.resetVariables(),BX.cleanNode(i.vars),BX.type.isElementNode(i.nothingFound)&&BX.hide(i.nothingFound),this.fireEvent("after-deselect-item"),void this.fireEvent("after-clear-selection");if(!1!==t&&(s.forceSelectSingeOnce=!0),void 0===s.cache.nodesByCode[e])this.resetNavVariables(),a.downloadBundle({CODE:e},function(t){if(a.fillCache(t,!1),void 0===s.cache.nodesByCode[e])a.showNothingFound();else{var i=s.cache.nodesByCode[e].VALUE;o.autoSelectIfOneVariant||s.forceSelectSingeOnce?a.selectItem(i):a.displayVariants([i])}},function(){s.forceSelectSingeOnce=!1});else{var n=s.cache.nodesByCode[e].VALUE;s.forceSelectSingeOnce?this.selectItem(n):this.displayVariants([n]),s.forceSelectSingeOnce=!1}},getNodeByValue:function(e){return"id"==this.opts.provideLinkBy?this.vars.cache.nodes[e]:this.vars.cache.nodesByCode[e]},getNodeByLocationId:function(e){return this.vars.cache.nodes[e]},setValue:function(e){"id"==this.opts.provideLinkBy?BX.Sale.component.location.selector.search.superclass.setValue.apply(this,[e]):this.setValueByLocationCode(e)},getValue:function(){return"id"==this.opts.provideLinkBy?!1===this.vars.value?"":this.vars.value:this.vars.value?this.vars.cache.nodes[this.vars.value].CODE:""},getSelectedPath:function(){var e=this.vars,t=[];if(void 0===e.value||0==e.value||""==e.value)return t;if(void 0!==e.cache.nodes[e.value]){void 0!==(i=BX.clone(e.cache.nodes[e.value])).TYPE_ID&&void 0!==this.opts.types&&(i.TYPE=this.opts.types[i.TYPE_ID].CODE);var s=i.PATH;if(delete i.PATH,t.push(i),void 0!==s)for(var o in s){var i;void 0!==(i=BX.clone(e.cache.nodes[s[o]])).TYPE_ID&&void 0!==this.opts.types&&(i.TYPE=this.opts.types[i.TYPE_ID].CODE),delete i.PATH,t.push(i)}}return t},setInitialValue:function(){!1!==this.opts.selectedItem?this.setValueByLocationId(this.opts.selectedItem):this.ctrls.inputs.origin.value.length>0&&("id"==this.opts.provideLinkBy?this.setValueByLocationId(this.ctrls.inputs.origin.value):this.setValueByLocationCode(this.ctrls.inputs.origin.value))},addItem2Cache:function(e){this.vars.cache.nodes[e.VALUE]=e,this.vars.cache.nodesByCode[e.CODE]=e},refineRequest:function(e){var t={};void 0!==e.QUERY&&(t["=PHRASE"]=e.QUERY),void 0!==e.VALUE&&(t["=ID"]=e.VALUE),void 0!==e.CODE&&(t["=CODE"]=e.CODE),void 0!==this.opts.query.BEHAVIOUR.LANGUAGE_ID&&(t["=NAME.LANGUAGE_ID"]=this.opts.query.BEHAVIOUR.LANGUAGE_ID),BX.type.isNotEmptyString(this.opts.query.FILTER.SITE_ID)&&(t["=SITE_ID"]=this.opts.query.FILTER.SITE_ID);var s={select:{VALUE:"ID",DISPLAY:"NAME.NAME",1:"CODE",2:"TYPE_ID"},additionals:{1:"PATH"},filter:t,version:"2"};return void 0!==e.order&&(s.order=e.order),s},refineResponce:function(e,t){if(void 0!==e.ETC.PATH_ITEMS){for(var s in e.ETC.PATH_ITEMS)BX.type.isNotEmptyString(e.ETC.PATH_ITEMS[s].DISPLAY)&&(this.vars.cache.path[s]=e.ETC.PATH_ITEMS[s].DISPLAY);for(var s in e.ITEMS){var o=e.ITEMS[s];if(void 0!==o.PATH){var i=BX.clone(o.PATH);for(var a in o.PATH){var n=o.PATH[a];if(i.shift(),void 0===this.vars.cache.nodes[n]&&void 0!==e.ETC.PATH_ITEMS[n]){var l=BX.clone(e.ETC.PATH_ITEMS[n]);l.PATH=BX.clone(i),this.vars.cache.nodes[n]=l}}}}}return e.ITEMS},refineItems:function(e){return e},refineItemDataForTemplate:function(e){return e},getSelectorValue:function(e){return"id"==this.opts.provideLinkBy?e:void 0!==this.vars.cache.nodes[e]?this.vars.cache.nodes[e].CODE:""},whenLoaderToggle:function(e){BX[e?"show":"hide"](this.ctrls.loader)}}));